(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[867],{2634:function(e,t,a){"use strict";a.d(t,{F:function(){return i}});var n=a(9895);let i=(0,n.fo)("Toast",{web:()=>a.e(56).then(a.bind(a,5056)).then(e=>new e.ToastWeb)})},3197:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/declaration",function(){return a(363)}])},363:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return DeclarationScreenPage}});var n=a(5893),i=a(1163),l=a(5138),r=a(2373),o=a(7294),s=a(3802),c=a(5122),d=a(8583),u=a(2634);function Loading(){return(0,n.jsx)("div",{className:"z-50 fixed inset-0 bg-gray-100 flex flex-col justify-center items-center",children:(0,n.jsx)(LoadingSpinner,{})})}function LoadingSpinner(e){let{className:t=""}=e;return(0,n.jsx)("img",{src:"/loadingspinner.svg",className:"w-10 h-10 invert ".concat(t)})}var p=a(3750);function SingleDeclarationHeader(e){var t;let{declaration:a}=e,r=(0,i.useRouter)(),o=null!==(t=null==a?void 0:a.status)&&void 0!==t?t:"concept";return(0,n.jsxs)("div",{className:"w-full justify-between items-center flex",children:[(0,n.jsxs)(l.Z,{secondary:!0,padding:"small",onClick:()=>r.back(),className:"!rounded-full",children:[(0,n.jsx)(p.And,{className:"w-4 h-4"}),"Terug"]}),(0,n.jsx)(l.Z,{primary:!0,padding:"small",className:"\n                        ".concat("ingediend"===o?"!bg-green-600":void 0,"\n                        ").concat("afgekeurd"===o?"!bg-red-600":void 0,"\n                        h-full !rounded-full\n                    "),children:o})]})}function SingleDeclaration(e){var t,a,p,f,h,m;let{declaration:g}=e,[v,x]=(0,o.useState)(g),[w,b]=(0,d.KO)(c.KX),[j,y]=(0,d.KO)(c.Je),N=null!==(h=null===(a=(0,i.useRouter)())||void 0===a?void 0:null===(t=a.query)||void 0===t?void 0:t.id)&&void 0!==h?h:null,D=null!==(m=null==v?void 0:v.status)&&void 0!==m?m:"concept",S=(0,i.useRouter)(),C="goedgekeurd"!==D&&"ingediend"!==D,[E,k]=(0,o.useState)(null==v?void 0:v.name),[B,J]=(0,o.useState)(null==v?void 0:v.description),[I,_]=(0,o.useState)(null==v?void 0:v.amount),[V,P]=(0,o.useState)(null==v?void 0:v.currency),[T,Z]=(0,o.useState)(null==v?void 0:v.category),[z,L]=(0,o.useState)(null==v?void 0:v.vat),[O,R]=(0,o.useState)(null==v?void 0:v.paymentMethod),[F,H]=(0,o.useState)(null==v?void 0:v.attachments),serializeDeclaration=e=>{var t;return{...N?{id:N,attachments:null==v?void 0:v.attachments}:{attachments:null==v?void 0:v.attachments},...E&&{name:E},...B&&{description:B},...I&&{amount:I},...V&&{currency:V},...T&&{category:T},...z&&{vat:z},...O&&{paymentMethod:O},status:null!==(t=null==e?void 0:e.status)&&void 0!==t?t:D}},[K,W]=(0,o.useState)(!1),handleSave=async e=>{e.preventDefault(),W(!0),N?await (0,s.Bb)(N,serializeDeclaration()):await (0,s.i0)(serializeDeclaration()),await u.F.show({text:"Declaratie opgeslagen."}),W(!1),await S.push("/")},handleSubmit=async e=>{e.preventDefault(),N?await (0,s.Bb)(N,serializeDeclaration({status:"ingediend"})):await (0,s.i0)(serializeDeclaration({status:"ingediend"})),await u.F.show({text:"Declaratie succesvol ingediend."}),b([]),await S.push("/")},handleDelete=async e=>{e.preventDefault(),await (0,s.pi)(N),await u.F.show({text:"Declaratie verwijderd."}),await S.push("/")};return(0,o.useEffect)(()=>{if((null==w?void 0:w.length)&&S.isReady)return x(e=>({...e,attachments:w})),()=>{b([])}},[S.pathname,S.asPath,w,S.isReady]),(0,o.useEffect)(()=>{N&&(0,s.QC)(N,null==v?void 0:v.attachments).then(e=>{b(e)})},[N]),(0,n.jsxs)(r.Z,{children:[(0,n.jsxs)("div",{className:"mt-8 grid gap-2 text-xs",children:[(0,n.jsx)(SingleDeclarationHeader,{declaration:v}),(0,n.jsxs)("div",{className:"bg-white p-4 space-y-2 rounded-md",children:[(0,n.jsx)("button",{disabled:!C,className:"text-xl font-extrabold focus:outline-2 outline-amber-400 break-all w-full h-auto overflow-hidden cursor-pointer text-left",onClick:()=>y({show:!0,title:"Voer een naam in:",type:"text",defaultValue:E,onConfirm:e=>k(e)}),children:null!=E?E:(0,n.jsx)("span",{className:"opacity-25",children:"Nieuwe uitgave"})}),(0,n.jsxs)("div",{className:"flex flex-row justify-between items-center text-lg",children:[(0,n.jsxs)("span",{className:"flex flex-row",children:[I," ",V]}),(0,n.jsx)("span",{})]}),(0,n.jsxs)("div",{className:"flex flex-row justify-between items-center text-xs opacity-50",children:[(0,n.jsx)("span",{children:"DECL-18992/565"}),(0,n.jsx)("span",{children:"08-06-1992"})]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-md p-4 grid gap-2 grid-cols-3 relative pt-5",children:[(0,n.jsx)("span",{className:(null==v?void 0:null===(p=v.attachments)||void 0===p?void 0:p.length)?"absolute top-1 left-4 text-[10px] opacity-50":"Bijlagen",children:"Bijlagen"}),null==v?void 0:null===(f=v.attachments)||void 0===f?void 0:f.map(e=>(0,n.jsx)("img",{src:e,className:"w-full h-[100px] p-2 object-contain rounded-md border-2 border-amber-400",fetchPriority:"high"},e))]}),(0,n.jsx)(CardInput,{allowEdit:C,value:B,onConfirm:e=>J(e),label:"Omschrijving",title:"Voer een omschrijving in:"}),(0,n.jsx)(CardInput,{allowEdit:C,value:T,onConfirm:e=>Z(e),label:"Categorie",title:"Voer een categorie in:",type:"select",options:["voeding","kleding","transport","accomodatie","overig"]}),(0,n.jsx)(CardInput,{allowEdit:C,value:I,onConfirm:e=>_(e),label:"Bedrag",title:"Voer een bedrag in:",type:"number"}),(0,n.jsx)(CardInput,{allowEdit:C,value:V,onConfirm:e=>P(e),label:"Valuta",title:"Voer een valuta in:",type:"select",options:["EUR","USD","GBP"]}),(0,n.jsx)(CardInput,{allowEdit:C,value:z,onConfirm:e=>L(e),label:"BTW percentage",title:"Voer een BTW percentage in:",type:"select",options:["0%","9%","21%"]}),(0,n.jsx)(CardInput,{allowEdit:C,value:O,onConfirm:e=>R(e),label:"Betaalmethode",title:"Voer een betaalmethode in:",type:"select",options:["cash","pin","creditcard"]}),C&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex flex-row justify-between items-center gap-2",children:[(0,n.jsxs)(l.Z,{secondary:!0,padding:"small",fullWidth:!0,onClick:handleSave,disabled:K,children:[K&&(0,n.jsx)("span",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)(LoadingSpinner,{className:"w-5 h-5"})}),(0,n.jsx)("span",{className:"!transition-none ".concat(K?"opacity-0":""),children:"Opslaan"})]}),(0,n.jsx)(l.Z,{primary:!0,padding:"small",fullWidth:!0,onClick:handleSubmit,children:"Indienen"})]}),(0,n.jsx)(l.Z,{tertiary:!0,padding:"small",fullWidth:!0,onClick:handleDelete,children:"Verwijderen"})]})]}),(0,n.jsx)("pre",{className:"break-all overflow-x-auto hidden",children:JSON.stringify(v,null,2)})]})}let CardInput=e=>{let{allowEdit:t,value:a,onConfirm:i,type:l="text",label:r,title:o,options:s}=e,[u,p]=(0,d.KO)(c.Je);return(0,n.jsxs)("button",{disabled:!t,className:"bg-white py-6 text-sm rounded-md p-4 cursor-pointer relative text-left",onClick:()=>p({...u,show:!0,title:null!=o?o:r,type:l,defaultValue:a,onConfirm:i,options:s}),children:[(0,n.jsx)("span",{className:a?"absolute top-1 text-[10px] opacity-50":"opacity-50",children:r}),a]})};function DeclarationScreenPage(){var e,t;let a=(0,i.useRouter)(),l=null!==(t=null===(e=a.query)||void 0===e?void 0:e.id)&&void 0!==t?t:null,[r,c]=(0,o.useState)(null);return((0,o.useEffect)(()=>{l&&(0,s.JX)(l).then(e=>{c(e)})},[l]),l&&!r)?(0,n.jsx)(Loading,{}):(0,n.jsx)(SingleDeclaration,{declaration:r})}},5138:function(e,t,a){"use strict";a.d(t,{Z:function(){return Button}});var n=a(5893),i=a(2081);function Button(e){let{primary:t=!1,secondary:a=!1,tertiary:l=!1,children:r,padding:o="large",fullWidth:s=!1,rounded:c="medium",className:d="",icon:u=null,...p}=e;return(0,n.jsxs)(i.E.button,{whileHover:{scale:1.01},whileTap:{scale:.99,backgroundColor:"rgba(0, 0, 0, 0.1)"},className:"\n            inline-flex flex-row justify-center items-center font-extrabold gap-2\n            ".concat("medium"===c?"rounded-md":"","\n            ").concat("large"===c?"rounded-lg":"","\n            ").concat("full"===c?"rounded-full":"","\n            ").concat(s?"w-full flex-1":"","\n            ").concat("large"===o?"p-8":"p-4 px-8","\n            ").concat(t?"bg-amber-400 text-white":"","\n            ").concat(t||l?"":"bg-gray-200 text-black","\n            ").concat(l?"bg-transparent text-black":"","\n            ").concat(d,"\n        "),...p,children:[u&&(0,n.jsx)("span",{className:"mr-auto",children:u}),(0,n.jsx)("span",{className:"flex-1 flex flex-row items-center justify-center text-center gap-2",children:r})]})}},2373:function(e,t,a){"use strict";a.d(t,{Z:function(){return Content}});var n=a(5893),i=a(2081);function Content(e){let{children:t,className:a=""}=e;return(0,n.jsx)(i.E.div,{className:"p-4 py-8 grid gap-2 ".concat(a),variants:{offscreen:{x:"100%"},onscreen:{x:0}},whileInView:"onscreen",initial:"offscreen",transition:{type:"spring",bounce:0,duration:.2},viewport:{once:!1,amount:0},children:t})}},3802:function(e,t,a){"use strict";a.d(t,{Bb:function(){return updateDeclaration},JX:function(){return getDeclaration},QC:function(){return getDeclarationAttachments},TH:function(){return getNotifications},b7:function(){return getDeclarations},i0:function(){return createDeclaration},pi:function(){return deleteDeclaration}});var n=a(3977),i=a(9828),l=a(6650);let r=(0,n.ZF)({apiKey:"AIzaSyBpqgq3YLSKhra1bMfQRdSYQJi-MZzOzPM",authDomain:"declaration-of-prototype.firebaseapp.com",projectId:"declaration-of-prototype",storageBucket:"declaration-of-prototype.appspot.com",messagingSenderId:"514470074938",appId:"1:514470074938:web:93348a7f5067b6fe9ab303"}),o=(0,i.ad)(r),s=(0,l.cF)(r,"gs://declaration-of-prototype.appspot.com"),c=(0,i.hJ)(o,"declarations"),getDeclarations=async()=>{let e=await (0,i.PL)(c),t=[];return e.forEach(e=>{t.push({...e.data(),id:e.id})}),t},getDeclaration=async e=>{var t;let a=(0,i.JU)(o,"declarations",e),n=await (0,i.QT)(a),r=[];for(let a=0;a<(null===(t=n.data())||void 0===t?void 0:t.attachments);a++){let t=(0,l.iH)(s,"".concat(e,"/").concat(a)),n=await (0,l.Jt)(t);r.push(n)}return{...n.data(),id:n.id,attachments:r}},createDeclaration=async e=>{var t,a;console.log("creating new declaration",e);let n=await (0,i.ET)((0,i.hJ)(o,"declarations"),{...e,attachments:null==e?void 0:null===(t=e.attachments)||void 0===t?void 0:t.length}),r=n.id,c=[];for(let t=0;t<(null==e?void 0:null===(a=e.attachments)||void 0===a?void 0:a.length);t++){let a=null==e?void 0:e.attachments[t],n=(0,l.iH)(s,"".concat(r,"/").concat(t)),i=(0,l.sf)(n,a,"data_url");c.push(i)}await Promise.all(c)},deleteDeclaration=async e=>{await (0,i.oe)((0,i.JU)(o,"declarations",e))},updateDeclaration=async(e,t)=>{var a;await (0,i.r7)((0,i.JU)(o,"declarations",e),{...t,attachments:null==t?void 0:null===(a=t.attachments)||void 0===a?void 0:a.length})},getDeclarationAttachments=async(e,t)=>{let a=[];for(let n=0;n<t;n++){let t=(0,l.iH)(s,"".concat(e,"/").concat(n)),i=await (0,l.Jt)(t);null==a||a.push(i)}return a},d=(0,i.hJ)(o,"notifications"),getNotifications=async()=>{let e=await (0,i.PL)(d),t=[];return e.forEach(e=>{t.push({...e.data(),id:e.id})}),t}}},function(e){e.O(0,[13,16,826,774,888,179],function(){return e(e.s=3197)}),_N_E=e.O()}]);